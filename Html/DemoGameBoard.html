<html>

<head>
	<link rel="stylesheet" href="css/main.css">
	<link rel="stylesheet" href="css/game_board.css">
	<link rel="stylesheet" href="css/belt.css">
	<link rel="stylesheet" href="css/marker.css">
	<link rel="stylesheet" href="css/card.css">
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <style type="text/css">
	</style>
</head>

<body class="c1 doc-content" id="body">
	<!-- configure Dojo -->
	<script>
		// Instead of using data-dojo-config, we're creating a dojoConfig
		// object *before* we load dojo.js; they're functionally identical,
		// it's just easier to read this approach with a larger configuration.
		var dojoConfig = {
			baseUrl: ".",
			async: true,
			// This code registers the correct location of the "demo"
			// package so we can load Dojo from the CDN whilst still
			// being able to load local modules
			packages: [
				{ name: "dojo", location: "../../bower_components/dojo" },
				{ name: "javascript", location: "javascript" }
			]
		};
	</script>
	<!-- load Dojo -->
	<script src="../../bower_components/dojo/dojo.js"></script>

    <script>
		require([
			'javascript/gameBoard',
			'javascript/gameUtils',
			'javascript/markers',
		], function (gameBoard, gameUtils, markers) {
            function generateDispenserInstanceDescs() {
                var nutTypes = gameUtils.nutTypesByVersion[gameUtils.version004_01]
                var numNutTypes = nutTypes.length
                var dispenserInstanceDescs =  []
                for (var i = 0; i < 3; i++) {
                    for (var j = 0; j < numNutTypes; j++) {
                        var nutType = nutTypes[j]
                        var index = i * numNutTypes + j
                        dispenserInstanceDescs[index] = {
                            markerType: nutType,
                        }
                    }
                }
                return dispenserInstanceDescs
            }

            function generateOrderInstanceDescs() {
                var nutTypes = gameUtils.nutTypesByVersion[gameUtils.version004_01]
                var numNutTypes = nutTypes.length
                var orderInstanceDescs =  []
                for (var i = 0; i < 3; i++) {
                    for (var j = 0; j < numNutTypes; j++) {
                        var nutIndex = (j + 2) % numNutTypes
                        var nutType = nutTypes[nutIndex]
                        var columnIndex = i * numNutTypes + j
                        orderInstanceDescs[columnIndex] = {
                            nutType: nutType,
                            columnIndex: columnIndex,
                        }
                    }
                }
                return orderInstanceDescs
            }

            gameUtils.setPageAllowsOverflow(true)
            gameUtils.setRowAllowsOverflow(true)

			gameBoard.createBoard(gameUtils.version004_01, {
				columnsPerStrip: 20,
				maxRowsPerPage: 20,
                factoryColumnCount: 12,
			})

            // Add nut dispensers.
            var dispenserInstanceDescs = generateDispenserInstanceDescs()
            for (var i = 0; i < dispenserInstanceDescs.length; i++) {
                var dispenserInstanceDesc = dispenserInstanceDescs[i]
                gameBoard.addMarker(gameBoard.dispensersRowId, i, dispenserInstanceDesc.markerType)
            }

            // Add squirrel and ghost squirrel.
            var squirrelRowId = `${gameBoard.squirrelRowPrefix}${0}`
            gameBoard.addMarker(squirrelRowId, 3, markers.markerTypes.Squirrel)
            gameBoard.addMarker(squirrelRowId, 4, markers.markerTypes.Squirrel, "ghost")

            // add Orders.
            var orderInstanceDescs = generateOrderInstanceDescs()
            gameBoard.addOrders(orderInstanceDescs)

		});
    </script>
</body>

</html>